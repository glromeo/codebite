"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.useMessaging = void 0;
const chalk_1 = __importDefault(require("chalk"));
const esnext_web_modules_1 = require("esnext-web-modules");
const nano_memoize_1 = __importDefault(require("nano-memoize"));
const tiny_node_logger_1 = __importDefault(require("tiny-node-logger"));
const ws_1 = __importDefault(require("ws"));
const multi_map_1 = require("./util/multi-map");
const watcher_1 = require("./watcher");
exports.useMessaging = (0, nano_memoize_1.default)((options) => {
    var _a, _b;
    const sockets = new Set();
    function broadcast(type, data) {
        const message = data === undefined ? type : JSON.stringify({ type, data });
        for (const ws of sockets) {
            ws.send(message);
        }
    }
    const callbacks = new multi_map_1.MultiMap();
    function on(type, cb) {
        callbacks.add(type, cb);
        tiny_node_logger_1.default.debug("added message listener for:", chalk_1.default.magenta(type));
    }
    const watcher = (0, watcher_1.useWatcher)(options);
    for (const plugin of (_b = (_a = options.messaging) === null || _a === void 0 ? void 0 : _a.plugins) !== null && _b !== void 0 ? _b : []) {
        plugin({ on, broadcast, options, watcher });
    }
    function openCallback(ws) {
        function send(type, data) {
            const message = data === undefined ? type : JSON.stringify({ type, data });
            return ws.send(message);
        }
        tiny_node_logger_1.default.debug("client connected:", ws.url);
        sockets.add(ws);
        ws.on("error", () => {
            tiny_node_logger_1.default.debug("client error:", ws.url);
        });
        ws.on("close", () => {
            tiny_node_logger_1.default.debug("client disconnected:", ws.url);
            sockets.delete(ws);
        });
        ws.on("message", function (message) {
            const { type, data } = message.charAt(0) === "{" ? JSON.parse(message) : { type: message };
            if (callbacks.has(type))
                for (const callback of callbacks.get(type)) {
                    callback(data, send);
                }
        });
        ws.send(JSON.stringify({ type: "hello", data: { time: new Date().toUTCString() } }));
    }
    function errorCallback(error) {
        tiny_node_logger_1.default.error("websocket error:", error);
    }
    function closeCallback() {
        tiny_node_logger_1.default.info("websocket closed");
    }
    esnext_web_modules_1.notifications.on("create", (notification) => {
        broadcast("notification:new", notification);
    });
    esnext_web_modules_1.notifications.on("update", (notification) => {
        broadcast("notification:update", notification);
    });
    return {
        handleUpgrade(req, socket, head) {
            if (req.headers["sec-websocket-protocol"] === "esnext-dev") {
                const wss = new ws_1.default.Server({ noServer: true });
                wss.on("open", openCallback);
                wss.on("error", errorCallback);
                wss.on("close", closeCallback);
                wss.handleUpgrade(req, socket, head, client => wss.emit("open", client, req));
                tiny_node_logger_1.default.info("websocket ready");
            }
        },
        broadcast
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnaW5nLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL21lc3NhZ2luZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxrREFBMEI7QUFFMUIsMkRBQXlFO0FBQ3pFLGdFQUFvQztBQUNwQyx3RUFBbUM7QUFDbkMsNENBQTJCO0FBRTNCLGdEQUEwQztBQUMxQyx1Q0FBcUM7QUFZeEIsUUFBQSxZQUFZLEdBQUcsSUFBQSxzQkFBUSxFQUFDLENBQUMsT0FBc0IsRUFBRSxFQUFFOztJQUU1RCxNQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsRUFBYSxDQUFDO0lBRXJDLFNBQVMsU0FBUyxDQUFDLElBQVksRUFBRSxJQUFVO1FBQ3ZDLE1BQU0sT0FBTyxHQUFHLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBQ3pFLEtBQUssTUFBTSxFQUFFLElBQUksT0FBTyxFQUFFO1lBQ3RCLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDcEI7SUFDTCxDQUFDO0lBRUQsTUFBTSxTQUFTLEdBQUcsSUFBSSxvQkFBUSxFQUEyQixDQUFDO0lBRTFELFNBQVMsRUFBRSxDQUFDLElBQVksRUFBRSxFQUFtQjtRQUN6QyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN4QiwwQkFBRyxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsRUFBRSxlQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDbEUsQ0FBQztJQUVELE1BQU0sT0FBTyxHQUFHLElBQUEsb0JBQVUsRUFBQyxPQUFPLENBQUMsQ0FBQztJQUVwQyxLQUFLLE1BQU0sTUFBTSxJQUFJLE1BQUEsTUFBQSxPQUFPLENBQUMsU0FBUywwQ0FBRSxPQUFPLG1DQUFJLEVB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QU0sR0FBRyxHQUFHLElBQUksWUFBUyxDQUFDLE1BQU0sQ0FBQyxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO2dCQUNuRCxHQUFHLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxZQUFZLENBQUMsQ0FBQztnQkFDN0IsR0FBRyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUM7Z0JBQy9CLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFDO2dCQUMvQixHQUFHLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQzlFLDBCQUFHLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7YUFDL0I7UUFDTCxDQUFDO1FBQ0QsU0FBUztLQUNaLENBQUM7QUFDTixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjaGFsayBmcm9tIFwiY2hhbGtcIjtcclxuaW1wb3J0IHtGU1dhdGNoZXJ9IGZyb20gXCJjaG9raWRhclwiO1xyXG5pbXBvcnQge25vdGlmaWNhdGlvbnMsIFdlYk1vZHVsZXNOb3RpZmljYXRpb259IGZyb20gXCJlc25leHQtd2ViLW1vZHVsZXNcIjtcclxuaW1wb3J0IG1lbW9pemVkIGZyb20gXCJuYW5vLW1lbW9pemVcIjtcclxuaW1wb3J0IGxvZyBmcm9tIFwidGlueS1ub2RlLWxvZ2dlclwiO1xyXG5pbXBvcnQgV2ViU29ja2V0IGZyb20gXCJ3c1wiO1xyXG5pbXBvcnQge0VTTmV4dE9wdGlvbnN9IGZyb20gXCIuL2NvbmZpZ3VyZVwiO1xyXG5pbXBvcnQge011bHRpTWFwfSBmcm9tIFwiLi91dGlsL211bHRpLW1hcFwiO1xyXG5pbXBvcnQge3VzZVdhdGNoZXJ9IGZyb20gXCIuL3dhdGNoZXJcIjtcclxuXHJcbmV4cG9ydCB0eXBlIE1lc3NhZ2UgPSB7IHR5cGU6IHN0cmluZywgZGF0YT86IGFueSB9O1xyXG5leHBvcnQgdHlwZSBTZW5kTWVzc2FnZSA9ICh0eXBlOiBzdHJpbmcsIGRhdGE/OiBhbnkpID0+IHZvaWQ7XHJcbmV4cG9ydCB0eXBlIE1lc3NhZ2VDYWxsYmFjayA9IChkYXRhOiBhbnksIHNlbmQ6IFNlbmRNZXNzYWdlKSA9PiB2b2lkO1xyXG5leHBvcnQgdHlwZSBPbk1lc3NhZ2UgPSAodHlwZTogc3RyaW5nLCBjYjogTWVzc2FnZUNhbGxiYWNrKSA9PiB2b2lkO1xyXG5leHBvcnQgdHlwZSBNZXNzYWdpbmdDb250ZXh0ID0geyBvbjogT25NZXNzYWdlLCBicm9hZGNhc3Q6IFNlbmRNZXNzYWdlLCBvcHRpb25zOiBFU05leHRPcHRpb25zLCB3YXRjaGVyOiBGU1dhdGNoZXIgfTtcclxuZXhwb3J0IHR5cGUgTWVzc2FnaW5nRW5kcG9pbnQgPSAobWVzc2FnaW5nQ29udGV4dDogTWVzc2FnaW5nQ29udGV4dCkgPT4gdm9pZDtcclxuZXhwb3J0IHR5cGUgTWVzc2FnaW5nT3B0aW9ucyA9IHtcclxuICAgIHBsdWdpbnM/OiAoTWVzc2FnaW5nRW5kcG9pbnQpW11cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHVzZU1lc3NhZ2luZyA9IG1lbW9pemVkKChvcHRpb25zOiBFU05leHRPcHRpb25zKSA9PiB7XHJcblxyXG4gICAgY29uc3Qgc29ja2V0cyA9IG5ldyBTZXQ8V2ViU29ja2V0PigpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGJyb2FkY2FzdCh0eXBlOiBzdHJpbmcsIGRhdGE/OiBhbnkpIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gZGF0YSA9PT0gdW5kZWZpbmVkID8gdHlwZSA6IEpTT04uc3RyaW5naWZ5KHt0eXBlLCBkYXRhfSk7XHJcbiAgICAgICAgZm9yIChjb25zdCB3cyBvZiBzb2NrZXRzKSB7XHJcbiAgICAgICAgICAgIHdzLnNlbmQobWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNhbGxiYWNrcyA9IG5ldyBNdWx0aU1hcDxzdHJpbmcsIE1lc3NhZ2VDYWxsYmFjaz4oKTtcclxuXHJcbiAgICBmdW5jdGlvbiBvbih0eXBlOiBzdHJpbmcsIGNiOiBNZXNzYWdlQ2FsbGJhY2spIHtcclxuICAgICAgICBjYWxsYmFja3MuYWRkKHR5cGUsIGNiKTtcclxuICAgICAgICBsb2cuZGVidWcoXCJhZGRlZCBtZXNzYWdlIGxpc3RlbmVyIGZvcjpcIiwgY2hhbGsubWFnZW50YSh0eXBlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgd2F0Y2hlciA9IHVzZVdhdGNoZXIob3B0aW9ucyk7XHJcblxyXG4gICAgZm9yIChjb25zdCBwbHVnaW4gb2Ygb3B0aW9ucy5tZXNzYWdpbmc/LnBsdWdpbnMgPz8gW10pIHtcclxuICAgICAgICBwbHVnaW4oe29uLCBicm9hZGNhc3QsIG9wdGlvbnMsIHdhdGNoZXJ9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBvcGVuQ2FsbGJhY2sod3M6IFdlYlNvY2tldCkge1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZW5kKHR5cGU6IHN0cmluZywgZGF0YT86IGFueSkge1xyXG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZGF0YSA9PT0gdW5kZWZpbmVkID8gdHlwZSA6IEpTT04uc3RyaW5naWZ5KHt0eXBlLCBkYXRhfSk7XHJcbiAgICAgICAgICAgIHJldHVybiB3cy5zZW5kKG1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbG9nLmRlYnVnKFwiY2xpZW50IGNvbm5lY3RlZDpcIiwgd3MudXJsKTtcclxuICAgICAgICBzb2NrZXRzLmFkZCh3cyk7XHJcblxyXG4gICAgICAgIHdzLm9uKFwiZXJyb3JcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2cuZGVidWcoXCJjbGllbnQgZXJyb3I6XCIsIHdzLnVybCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHdzLm9uKFwiY2xvc2VcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2cuZGVidWcoXCJjbGllbnQgZGlzY29ubmVjdGVkOlwiLCB3cy51cmwpO1xyXG4gICAgICAgICAgICBzb2NrZXRzLmRlbGV0ZSh3cyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHdzLm9uKFwibWVzc2FnZVwiLCBmdW5jdGlvbiAobWVzc2FnZTogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHt0eXBlLCBkYXRhfTogTWVzc2FnZSA9IG1lc3NhZ2UuY2hhckF0KDApID09PSBcIntcIiA/IEpTT04ucGFyc2UobWVzc2FnZSkgOiB7dHlwZTogbWVzc2FnZX07XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFja3MuaGFzKHR5cGUpKSBmb3IgKGNvbnN0IGNhbGxiYWNrIG9mIGNhbGxiYWNrcy5nZXQodHlwZSkhKSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhLCBzZW5kKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB3cy5zZW5kKEpTT04uc3RyaW5naWZ5KHt0eXBlOiBcImhlbGxvXCIsIGRhdGE6IHt0aW1lOiBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCl9fSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soZXJyb3IpIHtcclxuICAgICAgICBsb2cuZXJyb3IoXCJ3ZWJzb2NrZXQgZXJyb3I6XCIsIGVycm9yKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjbG9zZUNhbGxiYWNrKCkge1xyXG4gICAgICAgIGxvZy5pbmZvKFwid2Vic29ja2V0IGNsb3NlZFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBub3RpZmljYXRpb25zLm9uKFwiY3JlYXRlXCIsIChub3RpZmljYXRpb246IFdlYk1vZHVsZXNOb3RpZmljYXRpb24pID0+IHtcclxuICAgICAgICBicm9hZGNhc3QoXCJub3RpZmljYXRpb246bmV3XCIsIG5vdGlmaWNhdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBub3RpZmljYXRpb25zLm9uKFwidXBkYXRlXCIsIChub3RpZmljYXRpb246IFdlYk1vZHVsZXNOb3RpZmljYXRpb24pID0+IHtcclxuICAgICAgICBicm9hZGNhc3QoXCJub3RpZmljYXRpb246dXBkYXRlXCIsIG5vdGlmaWNhdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGhhbmRsZVVwZ3JhZGUocmVxLCBzb2NrZXQsIGhlYWQpIHtcclxuICAgICAgICAgICAgaWYgKHJlcS5oZWFkZXJzW1wic2VjLXdlYnNvY2tldC1wcm90b2NvbFwiXSA9PT0gXCJlc25leHQtZGV2XCIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdzcyA9IG5ldyBXZWJTb2NrZXQuU2VydmVyKHtub1NlcnZlcjogdHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgd3NzLm9uKFwib3BlblwiLCBvcGVuQ2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgd3NzLm9uKFwiZXJyb3JcIiwgZXJyb3JDYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICB3c3Mub24oXCJjbG9zZVwiLCBjbG9zZUNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgIHdzcy5oYW5kbGVVcGdyYWRlKHJlcSwgc29ja2V0LCBoZWFkLCBjbGllbnQgPT4gd3NzLmVtaXQoXCJvcGVuXCIsIGNsaWVudCwgcmVxKSk7XHJcbiAgICAgICAgICAgICAgICBsb2cuaW5mbyhcIndlYnNvY2tldCByZWFkeVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYnJvYWRjYXN0XHJcbiAgICB9O1xyXG59KTtcclxuIl19